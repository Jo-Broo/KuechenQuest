@page "/register"

@inject HttpClient Http
@inject NavigationManager Navigation

<div class="container">
    <img src="images/logoMedium.png" alt="KüchenQuest Logo" class="logo">
    <h1>KüchenQuest</h1>
    <div class="input-group">
        <input type="email" @bind="Email" placeholder="Email">
    </div>
    <div class="input-group">
        <input type="text" @bind="Username" placeholder="Anmeldename">
    </div>
    <div class="input-group">
        <input type="password" @bind="Password" placeholder="Passwort">
    </div>
    <div class="button-group">
        <button class="back-btn" @onclick="NavigateToLogin">Zurück</button>
        <button class="register-btn" @onclick="OnRegister">Registrieren</button>
    </div>
</div>

@code {
    private string Email { get; set; } = "";
    private string Username { get; set; } = "";
    private string Password { get; set; } = "";

    private async Task OnRegister()
    {
        Console.WriteLine("OnRegister() wurde aufgerufen!");  // Debugging

        if (string.IsNullOrWhiteSpace(Email) || string.IsNullOrWhiteSpace(Username) || string.IsNullOrWhiteSpace(Password))
        {
            Console.WriteLine("Bitte alle Felder ausfüllen.");
            return;
        }

        try
        {
            // Sende den POST-Request an den API-Endpunkt mit den Registrierungsdaten im Body
            var registerData = new { Email, Username, Password };
            var response = await Http.PostAsJsonAsync("https://192.168.37.240:7067/KuechenQuest/User/Register", registerData);

            if (response.IsSuccessStatusCode)
            {
                Console.WriteLine("Registrierung erfolgreich!");
                Navigation.NavigateTo("/login");
            }
            else
            {
                Console.WriteLine("Registrierung fehlgeschlagen.");
            }
        }
        catch (Exception ex)
        {
            Console.WriteLine("Fehler bei der Registrierung: " + ex.Message);
        }
    }

    private void NavigateToLogin()
    {
        Navigation.NavigateTo("/login");
    }
}
